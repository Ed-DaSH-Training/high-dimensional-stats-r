---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 04-clustering.md in _episodes_rmd/
title: "Clustering"
teaching: 0
exercises: 0
questions:
- "What does clustering mean?"
- "How can we cluster data with a model?"
- "How can we cluster data without a model?"
- "How can we check if clusters are robust?"
objectives:
- "Perform clustering with K-means and mixture models."
- "Assess clustering performance with silhouette score and bootstrapping."
keypoints:
- "KP1"
math: yes
---





~~~
## preamble
suppressPackageStartupMessages({
    library("scRNAseq")
    library("mixtools")
    library("irlba")
    library("scater")
    library("scuttle")
    library("scran")
    library("Rtsne")
    library("mclust")
    library("igraph")
    library("bluster")
})
set.seed(42)

if (!file.exists(here("data/scrnaseq.rds"))) {
    source(here("data/scrnaseq.R"))
}
~~~
{: .language-r}



~~~
Error in here("data/scrnaseq.rds"): could not find function "here"
~~~
{: .error}



~~~
norm <- readRDS(here("data/scrnaseq.rds"))
~~~
{: .language-r}



~~~
Error in here("data/scrnaseq.rds"): could not find function "here"
~~~
{: .error}



~~~
zd <- runPCA(zd, ncomponents = 15)
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'runPCA': object 'zd' not found
~~~
{: .error}



~~~
zd <- runTSNE(zd)
~~~
{: .language-r}



~~~
Error in runTSNE(zd): object 'zd' not found
~~~
{: .error}



~~~
## k-means

## ideas: vary centers, low iter.max, low nstart
cluster <- kmeans(reducedDim(zd), centers = 7, iter.max = 1000, nstart = 100)
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'reducedDim': object 'zd' not found
~~~
{: .error}



~~~
zd$kmeans <- as.character(cluster$cluster)
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'cluster' not found
~~~
{: .error}



~~~
plotReducedDim(zd, "TSNE", colour_by = "kmeans")
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'reducedDim': object 'zd' not found
~~~
{: .error}



~~~
## model-based
clust <- mclustBIC(reducedDim(zd), modelNames = "VVV")
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'reducedDim': object 'zd' not found
~~~
{: .error}



~~~
opt_clust <- which.max(clust)
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which.max': object 'clust' not found
~~~
{: .error}



~~~
zd$mixture <- as.character(opt_clust)
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'opt_clust' not found
~~~
{: .error}



~~~
plotReducedDim(zd, "TSNE", colour_by = "mixture")
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'reducedDim': object 'zd' not found
~~~
{: .error}



~~~
## graph-based
g <- buildSNNGraph(zd, k=10, use.dimred = 'PCA')
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'buildSNNGraph': object 'zd' not found
~~~
{: .error}



~~~
clust <- igraph::cluster_walktrap(g)$membership
~~~
{: .language-r}



~~~
Error in "igraph" %in% class(graph): object 'g' not found
~~~
{: .error}



~~~
reducedDim(zd, "force") <- igraph::layout_with_fr(g)
~~~
{: .language-r}



~~~
Error in "igraph" %in% class(graph): object 'g' not found
~~~
{: .error}



~~~
colLabels(zd) <- factor(clust)
~~~
{: .language-r}



~~~
Error in factor(clust): object 'clust' not found
~~~
{: .error}



~~~
plotReducedDim(zd, colour_by="label", dimred="force")
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'reducedDim': object 'zd' not found
~~~
{: .error}



~~~
# bluster::clusterRows - maybe?

## measures: silhouette, bootstrap
## approx silhouette? purity?
~~~
{: .language-r}


{% include links.md %}

